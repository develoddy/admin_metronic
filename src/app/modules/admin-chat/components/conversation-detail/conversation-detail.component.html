<div class="conv-detail">
  <div *ngIf="!selected" class="empty-panel">Selecciona una conversación para empezar</div>
  <div *ngIf="selected" class="detail-wrap">
    <div class="detail-header">
      <div class="left">
        <h4>Conversación #{{ selected.id }}</h4>
        <div class="meta">Usuario: {{ selected.user_id || selected.guest_id || selected.session_id }} • Estado: {{ selected.status }} • Agente: {{ selected.agent_name || 'Sin asignar' }}</div>
      </div>
      <div class="right">
        <div class="dates">Creada: {{ selected.createdAt | date:'short' }} • Actualizada: {{ selected.updatedAt | date:'short' }}</div>
        <div class="controls">
          <button class="btn btn-sm btn-outline-secondary" (click)="closeConversation()">Cerrar</button>
          <button class="btn btn-sm btn-outline-success" (click)="takeConversation()">Tomar / Reabrir</button>
        </div>
      </div>
    </div>

    <div #messagesContainer class="messages">
      <div *ngFor="let m of messages" class="msg" [ngClass]="{'agent': m.sender_type==='agent', 'user': m.sender_type==='user'}">
        <div class="meta">{{ m.sender_type }} • {{ m.timestamp | date:'shortTime' }}</div>
        <div class="content">{{ m.message }}</div>
      </div>
    </div>

    <div class="send-box">
      <textarea [(ngModel)]="newMessage" rows="3" placeholder="Escribir mensaje..."></textarea>
      <div class="actions">
        <button class="btn btn-sm btn-primary" (click)="send()">Enviar</button>
      </div>
    </div>
  </div>
</div>
