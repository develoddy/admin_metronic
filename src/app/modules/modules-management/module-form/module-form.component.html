<!--begin::Formulario de M√≥dulo-->
<div class="module-form">
  <!--begin::Header-->
  <div class="card mb-6">
    <div class="card-body">
      <div class="d-flex align-items-center">
        <button class="btn btn-sm btn-light me-3" (click)="cancel()">
          <i class="fas fa-arrow-left me-1"></i>
          Volver
        </button>
        <div>
          <h1 class="text-dark fw-bolder fs-2x mb-1">
            <i class="fas" [ngClass]="isEditMode ? 'fa-edit' : 'fa-plus'" class="text-primary me-2"></i>
            {{ isEditMode ? 'Editar M√≥dulo' : 'Crear Nuevo M√≥dulo' }}
          </h1>
          <p class="text-muted fs-6 mb-0">
            {{ isEditMode ? 'Actualiza la configuraci√≥n del m√≥dulo' : 'Define tu pr√≥ximo experimento Levels-style' }}
          </p>
        </div>
      </div>
    </div>
  </div>
  <!--end::Header-->

  <!--begin::Loading-->
  <div *ngIf="isLoading" class="card">
    <div class="card-body text-center py-20">
      <div class="spinner-border text-primary" role="status"></div>
      <p class="text-muted mt-3">Cargando m√≥dulo...</p>
    </div>
  </div>
  <!--end::Loading-->

  <!--begin::Form-->
  <form *ngIf="!isLoading" [formGroup]="moduleForm" (ngSubmit)="save()">
    <div class="row g-6">
      <!--begin::Informaci√≥n B√°sica-->
      <div class="col-lg-8">
        <div class="card mb-6">
          <div class="card-header">
            <h3 class="card-title">Informaci√≥n B√°sica</h3>
          </div>
          <div class="card-body">
            <!--begin::Key-->
            <div class="row mb-6">
              <label class="col-lg-3 col-form-label required fw-bold fs-6">Key (ID √∫nico)</label>
              <div class="col-lg-9">
                <div class="input-group">
                  <input 
                    type="text" 
                    class="form-control" 
                    formControlName="key"
                    placeholder="notion-templates"
                    [class.is-invalid]="hasError('key', 'required') || hasError('key', 'pattern')">
                  <button 
                    *ngIf="!isEditMode"
                    class="btn btn-light-primary" 
                    type="button"
                    (click)="generateKey()">
                    <i class="fas fa-magic"></i> Auto
                  </button>
                </div>
                <div class="form-text">Solo letras min√∫sculas, n√∫meros y guiones (a-z, 0-9, -)</div>
                <div *ngIf="hasError('key', 'required')" class="invalid-feedback d-block">
                  El key es requerido
                </div>
                <div *ngIf="hasError('key', 'pattern')" class="invalid-feedback d-block">
                  Solo se permiten letras min√∫sculas, n√∫meros y guiones
                </div>
              </div>
            </div>
            <!--end::Key-->

            <!--begin::Name-->
            <div class="row mb-6">
              <label class="col-lg-3 col-form-label required fw-bold fs-6">Nombre</label>
              <div class="col-lg-9">
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="name"
                  placeholder="Plantillas Notion Premium"
                  [class.is-invalid]="hasError('name', 'required') || hasError('name', 'minlength')">
                <div class="form-text">Nombre descriptivo del m√≥dulo</div>
                <div *ngIf="hasError('name', 'required')" class="invalid-feedback d-block">
                  El nombre es requerido
                </div>
                <div *ngIf="hasError('name', 'minlength')" class="invalid-feedback d-block">
                  El nombre debe tener al menos 3 caracteres
                </div>
              </div>
            </div>
            <!--end::Name-->

            <!--begin::Description-->
            <div class="row mb-6">
              <label class="col-lg-3 col-form-label required fw-bold fs-6">Descripci√≥n</label>
              <div class="col-lg-9">
                <textarea 
                  class="form-control" 
                  formControlName="description"
                  rows="3"
                  placeholder="Pack de 10 plantillas premium para Notion: productividad, finanzas, proyectos..."
                  [class.is-invalid]="hasError('description', 'required')"></textarea>
                <div class="form-text">Descripci√≥n breve del m√≥dulo</div>
                <div *ngIf="hasError('description', 'required')" class="invalid-feedback d-block">
                  La descripci√≥n es requerida
                </div>
              </div>
            </div>
            <!--end::Description-->

            <!--begin::Type-->
            <div class="row mb-6">
              <label class="col-lg-3 col-form-label required fw-bold fs-6">Tipo</label>
              <div class="col-lg-9">
                <select 
                  class="form-select" 
                  formControlName="type"
                  [class.is-invalid]="hasError('type', 'required')">
                  <option *ngFor="let opt of typeOptions" [value]="opt.value">
                    {{ opt.label }}
                  </option>
                </select>
                <div class="form-text">Tipo de producto/servicio</div>
              </div>
            </div>
            <!--end::Type-->

            <!--begin::Status-->
            <div class="row mb-6" *ngIf="isEditMode">
              <label class="col-lg-3 col-form-label fw-bold fs-6">Estado</label>
              <div class="col-lg-9">
                <select 
                  class="form-select" 
                  formControlName="status">
                  <option *ngFor="let opt of statusOptions" [value]="opt.value">
                    {{ opt.label }} - {{ opt.description }}
                  </option>
                </select>
                <div class="form-text">
                  <strong>Draft:</strong> Borrador (invisible) | 
                  <strong>Testing:</strong> Validaci√≥n activa | 
                  <strong>Live:</strong> P√∫blico en frontend | 
                  <strong>Archived:</strong> Archivado
                </div>
              </div>
            </div>
            <!--end::Status-->

            <!--begin::Base Price-->
            <div class="row mb-6">
              <label class="col-lg-3 col-form-label fw-bold fs-6">Precio Base</label>
              <div class="col-lg-9">
                <div class="input-group">
                  <input 
                    type="number" 
                    class="form-control" 
                    formControlName="base_price"
                    placeholder="19.99"
                    step="0.01"
                    min="0">
                  <span class="input-group-text">‚Ç¨</span>
                </div>
                <div class="form-text">Precio base del producto (opcional)</div>
              </div>
            </div>
            <!--end::Base Price-->
          </div>
        </div>

        <!--begin::üöÄ Configuraci√≥n SaaS-->
        <div class="card mb-6" *ngIf="isSaaSModule">
          <div class="card-header bg-light-success">
            <h3 class="card-title">
              <i class="fas fa-rocket text-success me-2"></i>
              Configuraci√≥n SaaS (Subscripci√≥n)
            </h3>
            <div class="card-toolbar">
              <span class="badge badge-light-success">Modo SaaS Activado</span>
            </div>
          </div>
          <div class="card-body">
            
            <!--begin::Trial Days-->
            <div class="row mb-6">
              <label class="col-lg-3 col-form-label fw-bold fs-6">D√≠as de Trial</label>
              <div class="col-lg-9">
                <input 
                  type="number" 
                  class="form-control" 
                  formControlName="saas_trial_days"
                  placeholder="14"
                  min="0">
                <div class="form-text">D√≠as de prueba gratuita (ej: 14, 30)</div>
              </div>
            </div>
            <!--end::Trial Days-->

            <!--begin::Dashboard Route-->
            <div class="row mb-6">
              <label class="col-lg-3 col-form-label fw-bold fs-6">Ruta Dashboard</label>
              <div class="col-lg-9">
                <div class="input-group">
                  <span class="input-group-text">tienda.lujandev.com/app/</span>
                  <input 
                    type="text" 
                    class="form-control" 
                    formControlName="saas_dashboard_route"
                    placeholder="newsletter-campaigns">
                </div>
                <div class="form-text">Ruta del dashboard del cliente despu√©s de iniciar trial (ej: newsletter-campaigns)</div>
              </div>
            </div>
            <!--end::Dashboard Route-->

            <!--begin::API Endpoint-->
            <div class="row mb-6">
              <label class="col-lg-3 col-form-label fw-bold fs-6">API Endpoint</label>
              <div class="col-lg-9">
                <div class="input-group">
                  <span class="input-group-text">api.lujandev.com/</span>
                  <input 
                    type="text" 
                    class="form-control" 
                    formControlName="saas_api_endpoint"
                    placeholder="newsletter-campaigns">
                </div>
                <div class="form-text">Endpoint base de la API del m√≥dulo</div>
              </div>
            </div>
            <!--end::API Endpoint-->

            <hr class="my-6">

            <!--begin::Pricing Plans-->
            <div class="row mb-6">
              <label class="col-lg-3 col-form-label fw-bold fs-6">Planes de Pricing</label>
              <div class="col-lg-9">
                
                <!-- Agregar Plan -->
                <div class="card card-flush border mb-4">
                  <div class="card-header bg-light">
                    <h4 class="card-title mb-0">
                      <i class="fas fa-plus-circle text-primary me-2"></i>
                      Agregar Plan
                    </h4>
                  </div>
                  <div class="card-body">
                    <div class="row g-3">
                      <div class="col-md-3">
                        <label class="form-label small fw-bold">Nombre del Plan *</label>
                        <input 
                          type="text" 
                          class="form-control" 
                          [(ngModel)]="newPlanName"
                          [ngModelOptions]="{standalone: true}"
                          placeholder="Starter">
                      </div>
                      <div class="col-md-2">
                        <label class="form-label small fw-bold">Precio (‚Ç¨) *</label>
                        <input 
                          type="number" 
                          class="form-control" 
                          [(ngModel)]="newPlanPrice"
                          [ngModelOptions]="{standalone: true}"
                          placeholder="9.99"
                          step="0.01"
                          min="0">
                      </div>
                      <div class="col-md-5">
                        <label class="form-label small fw-bold">Descripci√≥n</label>
                        <input 
                          type="text" 
                          class="form-control" 
                          [(ngModel)]="newPlanDescription"
                          [ngModelOptions]="{standalone: true}"
                          placeholder="Hasta 1000 suscriptores">
                      </div>
                      <div class="col-md-2">
                        <label class="form-label small fw-bold">Destacar</label>
                        <div class="form-check form-switch form-check-custom form-check-solid mt-2">
                          <input 
                            class="form-check-input" 
                            type="checkbox" 
                            [(ngModel)]="newPlanRecommended"
                            [ngModelOptions]="{standalone: true}"
                            id="newPlanRecommended">
                          <label class="form-check-label small" for="newPlanRecommended">
                            Recomendado
                          </label>
                        </div>
                      </div>
                    </div>
                    <div class="mt-3">
                      <button 
                        type="button" 
                        class="btn btn-sm btn-primary"
                        (click)="addSaaSPlan()">
                        <i class="fas fa-plus me-1"></i> Agregar Plan
                      </button>
                      <small class="text-muted ms-3">
                        <i class="fas fa-info-circle me-1"></i>
                        El plan marcado como "Recomendado" se destacar√° con borde azul en el frontend
                      </small>
                    </div>
                  </div>
                </div>

                <!-- Lista de Planes -->
                <div *ngIf="saasPricingPlans.length > 0" class="mb-3">
                  <h6 class="fw-bold mb-3">Planes Configurados ({{ saasPricingPlans.length }})</h6>
                  <div class="row g-3">
                    <div *ngFor="let plan of saasPricingPlans; let i = index" class="col-md-6">
                      <div class="card shadow-sm" 
                           [ngClass]="{'border-primary border-2': plan.recommended}">
                        
                        <!-- Badge recomendado -->
                        <span 
                          *ngIf="plan.recommended" 
                          class="badge bg-primary position-absolute top-0 end-0 m-2">
                          <i class="fas fa-star me-1"></i> Recomendado
                        </span>
                        
                        <div class="card-body">
                          <div class="d-flex justify-content-between align-items-start mb-2">
                            <div class="flex-grow-1">
                              <h5 class="mb-1">
                                <i class="fas fa-tag text-success me-2"></i>
                                {{ plan.name }}
                              </h5>
                              <p class="text-muted small mb-2">{{ plan.description || 'Sin descripci√≥n' }}</p>
                            </div>
                            <button 
                              type="button" 
                              class="btn btn-sm btn-light-danger ms-2"
                              (click)="removeSaaSPlan(i)">
                              <i class="fas fa-trash"></i>
                            </button>
                          </div>
                          
                          <div class="d-flex align-items-baseline mb-3">
                            <h3 class="text-success mb-0">{{ plan.price }}‚Ç¨</h3>
                            <span class="text-muted ms-2">/mes</span>
                          </div>

                          <!-- Toggle recomendado -->
                          <div class="form-check form-switch">
                            <input 
                              class="form-check-input" 
                              type="checkbox" 
                              [checked]="plan.recommended"
                              (change)="toggleRecommendedPlan(i)"
                              [id]="'recommended-' + i">
                            <label class="form-check-label small" [for]="'recommended-' + i">
                              <i class="fas fa-star me-1" [class.text-warning]="plan.recommended"></i>
                              Marcar como recomendado
                            </label>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div *ngIf="saasPricingPlans.length === 0" class="alert alert-warning">
                  <i class="fas fa-info-circle me-2"></i>
                  No hay planes configurados. Agrega al menos un plan de pricing.
                </div>
              </div>
            </div>
            <!--end::Pricing Plans-->

          </div>
        </div>
        <!--end::üöÄ Configuraci√≥n SaaS-->

        <!--begin::Contenido de Marketing-->
        <div class="card mb-6">
          <div class="card-header">
            <h3 class="card-title">
              <i class="fas fa-bullhorn text-info me-2"></i>
              Contenido de Marketing
            </h3>
          </div>
          <div class="card-body">
            <!--begin::Tagline-->
            <div class="row mb-6">
              <label class="col-lg-3 col-form-label fw-bold fs-6">Tagline</label>
              <div class="col-lg-9">
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="tagline"
                  placeholder="Automatiza sitemap.xml y robots.txt desde tu admin">
                <div class="form-text">Frase corta y atractiva (m√°x. 255 caracteres)</div>
              </div>
            </div>
            <!--end::Tagline-->

            <!--begin::Detailed Description-->
            <div class="row mb-6">
              <label class="col-lg-3 col-form-label fw-bold fs-6">Descripci√≥n Detallada</label>
              <div class="col-lg-9">
                <textarea 
                  class="form-control" 
                  formControlName="detailed_description"
                  rows="5"
                  placeholder="Descripci√≥n completa del producto para la landing page. Puedes usar HTML b√°sico."></textarea>
                <div class="form-text">Descripci√≥n larga para la landing page (soporta HTML)</div>
              </div>
            </div>
            <!--end::Detailed Description-->

            <!--begin::Screenshots-->
            <div class="row mb-6">
              <label class="col-lg-3 col-form-label fw-bold fs-6">Screenshots</label>
              <div class="col-lg-9">
                <!-- üÜï Drag & Drop Zone -->
                <div 
                  class="upload-dropzone mb-4 p-5 border-2 border-dashed rounded-3 text-center bg-light-primary position-relative"
                  (dragover)="onDragOver($event)"
                  (drop)="onDrop($event)"
                  style="transition: all 0.3s ease; cursor: pointer;"
                  (mouseenter)="$event.currentTarget.style.borderColor='var(--bs-primary)'; $event.currentTarget.style.backgroundColor='rgba(var(--bs-primary-rgb), 0.05)'"
                  (mouseleave)="$event.currentTarget.style.borderColor='var(--bs-border-color)'; $event.currentTarget.style.backgroundColor='var(--bs-light-primary)'">
                  
                  <input 
                    type="file" 
                    id="screenshotFiles"
                    class="position-absolute top-0 start-0 w-100 h-100 opacity-0"
                    style="cursor: pointer;"
                    accept="image/jpeg,image/jpg,image/png,image/gif,image/webp"
                    multiple
                    (change)="onFileSelected($event)">
                  
                  <div class="pointer-events-none">
                    <i class="fas fa-cloud-upload-alt fs-3x text-primary mb-3 d-block"></i>
                    <h5 class="fw-bold text-gray-700 mb-2">
                      Arrastra im√°genes aqu√≠ o haz clic para seleccionar
                    </h5>
                    <p class="text-muted mb-0">
                      <i class="fas fa-info-circle me-1"></i>
                      Formatos: JPG, PNG, GIF, WebP ‚Ä¢ M√°x. 5MB por imagen ‚Ä¢ Hasta 10 im√°genes
                    </p>
                  </div>
                </div>
                
                <!-- Loading State -->
                <div *ngIf="uploadingScreenshot" class="alert alert-info d-flex align-items-center mb-4">
                  <div class="spinner-border spinner-border-sm me-3"></div>
                  <div>
                    <strong>Subiendo im√°genes...</strong>
                    <p class="mb-0 small text-muted">Por favor espera mientras se procesan los archivos</p>
                  </div>
                </div>

                <hr class="my-4">

                <!-- URL Manual (alternativa) -->
                <div class="mb-3">
                  <label class="form-label text-muted small">O agregar URL manualmente:</label>
                  <div class="input-group">
                    <input 
                      type="url" 
                      class="form-control" 
                      #screenshotUrl
                      placeholder="https://ejemplo.com/imagen.png">
                    <button 
                      class="btn btn-secondary" 
                      type="button"
                      (click)="addScreenshot(screenshotUrl.value); screenshotUrl.value = ''">
                      <i class="fas fa-plus me-1"></i> Agregar URL
                    </button>
                  </div>
                </div>
                
                <!-- Preview de screenshots -->
                <div *ngIf="screenshots.length > 0" class="mt-4">
                  <h6 class="fw-bold mb-3">Screenshots ({{ screenshots.length }})</h6>
                  <div class="row g-3">
                    <div *ngFor="let screenshot of screenshots; let i = index" class="col-md-4">
                      <div class="card border shadow-sm">
                        <div class="position-relative" style="height: 150px; overflow: hidden; background: #f8f9fa;">
                          <img 
                            [src]="screenshot" 
                            class="w-100 h-100"
                            style="object-fit: cover;"
                            (error)="onImageError($event)"
                            (load)="onImageLoad($event)"
                            alt="Screenshot"
                            loading="lazy">
                          <div *ngIf="!screenshot" class="position-absolute top-50 start-50 translate-middle text-muted">
                            <i class="fas fa-image fa-3x"></i>
                          </div>
                        </div>
                        <div class="card-body p-2">
                          <small class="text-muted d-block mb-2" 
                                 style="font-size: 10px; word-break: break-all; max-height: 40px; overflow: hidden;">
                            {{ screenshot }}
                          </small>
                          <button 
                            type="button" 
                            class="btn btn-sm btn-danger w-100"
                            (click)="removeScreenshot(i)">
                            <i class="fas fa-trash me-1"></i> Eliminar
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="alert alert-warning mt-3" *ngIf="screenshots.length < 4">
                  <i class="fas fa-exclamation-triangle me-2"></i>
                  Recomendaci√≥n: Agrega al menos 4 screenshots para una mejor presentaci√≥n
                </div>
              </div>
            </div>
            <!--end::Screenshots-->

            <!--begin::Download ZIP-->
            <div class="row mb-6" *ngIf="moduleForm.get('type')?.value === 'digital'">
              <label class="col-lg-3 col-form-label required fw-bold fs-6">Archivo ZIP</label>
              <div class="col-lg-9">
                <!-- üÜï Drag & Drop Zone para ZIP -->
                <div 
                  *ngIf="!moduleForm.get('download_url')?.value"
                  class="upload-dropzone mb-3 p-5 border-2 border-dashed rounded-3 text-center bg-light-success position-relative"
                  (dragover)="onDragOver($event)"
                  (drop)="onZipDrop($event)"
                  style="transition: all 0.3s ease; cursor: pointer;"
                  (mouseenter)="$event.currentTarget.style.borderColor='var(--bs-success)'; $event.currentTarget.style.backgroundColor='rgba(var(--bs-success-rgb), 0.05)'"
                  (mouseleave)="$event.currentTarget.style.borderColor='var(--bs-border-color)'; $event.currentTarget.style.backgroundColor='var(--bs-light-success)'">
                  
                  <input 
                    type="file" 
                    id="zipFile"
                    class="position-absolute top-0 start-0 w-100 h-100 opacity-0"
                    style="cursor: pointer;"
                    accept=".zip,application/zip,application/x-zip,application/x-zip-compressed"
                    (change)="onZipFileSelected($event)">
                  
                  <div class="pointer-events-none">
                    <i class="fas fa-file-archive fs-3x text-success mb-3 d-block"></i>
                    <h5 class="fw-bold text-gray-700 mb-2">
                      Arrastra el archivo ZIP aqu√≠ o haz clic para seleccionar
                    </h5>
                    <p class="text-muted mb-0">
                      <i class="fas fa-info-circle me-1"></i>
                      Solo archivos .zip ‚Ä¢ M√°x. 100MB
                    </p>
                  </div>
                </div>
                
                <!-- Loading State -->
                <div *ngIf="uploadingZip" class="alert alert-info mb-3">
                  <div class="d-flex align-items-center mb-3">
                    <div class="spinner-border spinner-border-sm me-3"></div>
                    <div class="flex-grow-1">
                      <strong>Subiendo archivo ZIP...</strong>
                      <p class="mb-0 small text-muted">
                        {{ zipUploadProgress }}% completado
                        <span *ngIf="zipFileSize > 0"> ‚Ä¢ {{ formatFileSize(zipFileSize) }}</span>
                      </p>
                    </div>
                  </div>
                  <!-- Barra de progreso -->
                  <div class="progress" style="height: 8px;">
                    <div 
                      class="progress-bar progress-bar-striped progress-bar-animated bg-primary" 
                      role="progressbar" 
                      [style.width.%]="zipUploadProgress"
                      [attr.aria-valuenow]="zipUploadProgress" 
                      aria-valuemin="0" 
                      aria-valuemax="100">
                    </div>
                  </div>
                  <small class="text-muted d-block mt-2">
                    <i class="fas fa-info-circle me-1"></i>
                    Por favor espera, archivos grandes pueden tardar varios minutos
                  </small>
                </div>

                <!-- Preview del archivo ZIP subido -->
                <div *ngIf="moduleForm.get('download_url')?.value && !uploadingZip" class="card border-success mb-3">
                  <div class="card-body">
                    <div class="d-flex align-items-center justify-content-between">
                      <div class="d-flex align-items-center">
                        <div class="symbol symbol-50px me-3">
                          <div class="symbol-label bg-light-success">
                            <i class="fas fa-file-archive fs-2x text-success"></i>
                          </div>
                        </div>
                        <div>
                          <h6 class="fw-bold mb-1">{{ zipFileName || 'archivo.zip' }}</h6>
                          <p class="text-muted mb-0 small">
                            <i class="fas fa-check-circle text-success me-1"></i>
                            Archivo subido correctamente
                            <span *ngIf="zipFileSize > 0"> ‚Ä¢ {{ formatFileSize(zipFileSize) }}</span>
                          </p>
                          <a 
                            [href]="moduleForm.get('download_url')?.value" 
                            target="_blank"
                            class="text-primary small d-block mt-1">
                            <i class="fas fa-external-link-alt me-1"></i>
                            Ver archivo
                          </a>
                        </div>
                      </div>
                      <button 
                        type="button" 
                        class="btn btn-sm btn-light-danger"
                        (click)="removeZipFile()"
                        [disabled]="uploadingZip">
                        <i class="fas fa-trash me-1"></i> Eliminar
                      </button>
                    </div>
                  </div>
                </div>

                <div class="form-text">
                  <i class="fas fa-info-circle me-1"></i>
                  El archivo ZIP debe contener todo el c√≥digo fuente o recursos del producto digital
                </div>
                
                <div class="alert alert-warning mt-3" *ngIf="!moduleForm.get('download_url')?.value">
                  <i class="fas fa-exclamation-triangle me-2"></i>
                  <strong>Obligatorio:</strong> Los productos digitales requieren un archivo ZIP para descarga
                </div>
              </div>
            </div>
            <!--end::Download ZIP-->
          </div>
        </div>

        <!--begin::Features-->
        <div class="card mb-6">
          <div class="card-header">
            <h3 class="card-title">
              <i class="fas fa-check-circle text-success me-2"></i>
              Caracter√≠sticas
            </h3>
          </div>
          <div class="card-body">
            <div class="input-group mb-3">
              <input 
                type="text" 
                class="form-control" 
                [(ngModel)]="newFeature"
                [ngModelOptions]="{standalone: true}"
                (keyup.enter)="addFeature()"
                placeholder="Ej: Sincronizaci√≥n autom√°tica con DB">
              <button 
                class="btn btn-success" 
                type="button"
                (click)="addFeature()">
                <i class="fas fa-plus me-1"></i> Agregar
              </button>
            </div>
            
            <!-- Lista de features -->
            <div *ngIf="features.length > 0" class="mt-3">
              <div *ngFor="let feature of features; let i = index" 
                   class="d-flex align-items-center border-bottom py-2">
                <i class="fas fa-check-circle text-success me-2"></i>
                <div class="flex-grow-1">{{ feature }}</div>
                <button 
                  type="button" 
                  class="btn btn-sm btn-light"
                  (click)="removeFeature(i)">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
            
            <div class="form-text mt-3">
              <i class="fas fa-info-circle me-1"></i>
              Lista de beneficios o caracter√≠sticas clave
            </div>
          </div>
        </div>

        <!--begin::Tech Stack-->
        <div class="card mb-6">
          <div class="card-header">
            <h3 class="card-title">
              <i class="fas fa-code text-primary me-2"></i>
              Stack Tecnol√≥gico
            </h3>
          </div>
          <div class="card-body">
            <div class="input-group mb-3">
              <input 
                type="text" 
                class="form-control" 
                [(ngModel)]="newTech"
                [ngModelOptions]="{standalone: true}"
                (keyup.enter)="addTech()"
                placeholder="Ej: Node.js, Angular, MongoDB">
              <button 
                class="btn btn-primary" 
                type="button"
                (click)="addTech()">
                <i class="fas fa-plus me-1"></i> Agregar
              </button>
            </div>
            
            <!-- Lista de tech stack -->
            <div *ngIf="techStack.length > 0" class="mt-3">
              <div class="d-flex flex-wrap gap-2">
                <span *ngFor="let tech of techStack; let i = index" 
                      class="badge bg-light-primary text-primary fs-7 px-3 py-2">
                  {{ tech }}
                  <button 
                    type="button" 
                    class="btn btn-sm btn-link p-0 ms-2"
                    (click)="removeTech(i)">
                    <i class="fas fa-times text-primary"></i>
                  </button>
                </span>
              </div>
            </div>
            
            <div class="form-text mt-3">
              <i class="fas fa-info-circle me-1"></i>
              Tecnolog√≠as usadas en el proyecto
            </div>
          </div>
        </div>

        <!--begin::Email Post-Compra-->
        <div class="card mb-6" *ngIf="moduleForm.get('type')?.value === 'digital' || moduleForm.get('type')?.value === 'service'">
          <div class="card-header">
            <h3 class="card-title">
              <i class="fas fa-envelope text-info me-2"></i>
              Email Post-Compra
            </h3>
          </div>
          <div class="card-body">
            <textarea 
              class="form-control font-monospace" 
              formControlName="post_purchase_email"
              rows="10"
              placeholder="<h2>¬°Gracias por tu compra!</h2>
<p>Aqu√≠ est√° tu producto...</p>"></textarea>
            <div class="form-text">
              <i class="fas fa-info-circle me-1"></i>
              Template HTML del email que se enviar√° autom√°ticamente despu√©s de la compra
            </div>
          </div>
        </div>

        <!--begin::Validaci√≥n Levels-style-->
        <div class="card mb-6">
          <div class="card-header">
            <h3 class="card-title">
              <i class="fas fa-rocket text-warning me-2"></i>
              Validaci√≥n Levels-style
            </h3>
          </div>
          <div class="card-body">
            <div class="alert alert-warning d-flex align-items-center mb-6">
              <i class="fas fa-lightbulb fs-2x me-3"></i>
              <div>
                <strong>Filosof√≠a Levels:</strong> Cada idea debe validarse r√°pidamente.
                Define X ventas en Y d√≠as. Si no alcanza el target ‚Üí KILL y siguiente experimento.
              </div>
            </div>

            <!--begin::Validation Days-->
            <div class="row mb-6">
              <label class="col-lg-4 col-form-label required fw-bold fs-6">D√≠as para validar</label>
              <div class="col-lg-8">
                <input 
                  type="number" 
                  class="form-control" 
                  formControlName="validation_days"
                  min="1"
                  max="90"
                  [class.is-invalid]="hasError('validation_days', 'required') || hasError('validation_days', 'min')">
                <div class="form-text">Tiempo l√≠mite para alcanzar el target</div>
                <div *ngIf="hasError('validation_days', 'required')" class="invalid-feedback d-block">
                  Los d√≠as de validaci√≥n son requeridos
                </div>
              </div>
            </div>
            <!--end::Validation Days-->

            <!--begin::Target Sales-->
            <div class="row mb-6">
              <label class="col-lg-4 col-form-label required fw-bold fs-6">Ventas objetivo</label>
              <div class="col-lg-8">
                <input 
                  type="number" 
                  class="form-control" 
                  formControlName="validation_target_sales"
                  min="1"
                  [class.is-invalid]="hasError('validation_target_sales', 'required') || hasError('validation_target_sales', 'min')">
                <div class="form-text">N√∫mero m√≠nimo de ventas para validar</div>
                <div *ngIf="hasError('validation_target_sales', 'required')" class="invalid-feedback d-block">
                  El target de ventas es requerido
                </div>
              </div>
            </div>
            <!--end::Target Sales-->

            <!--begin::Preview-->
            <div class="bg-light-warning rounded p-4">
              <div class="d-flex align-items-center">
                <i class="fas fa-bullseye fs-2x text-warning me-3"></i>
                <div>
                  <strong class="d-block text-dark">Target del m√≥dulo:</strong>
                  <span class="text-muted">
                    {{ moduleForm.get('validation_target_sales')?.value || 0 }} ventas
                    en {{ moduleForm.get('validation_days')?.value || 0 }} d√≠as
                  </span>
                </div>
              </div>
            </div>
            <!--end::Preview-->
          </div>
        </div>
      </div>
      <!--end::Informaci√≥n B√°sica-->

      <!--begin::Personalizaci√≥n-->
      <div class="col-lg-4">
        <div class="card mb-6">
          <div class="card-header">
            <h3 class="card-title">Personalizaci√≥n</h3>
          </div>
          <div class="card-body">
            <!--begin::Icon-->
            <div class="mb-6">
              <label class="form-label required fw-bold fs-6">Icono</label>
              <select 
                class="form-select" 
                formControlName="icon">
                <option *ngFor="let icon of iconOptions" [value]="icon">
                  {{ icon }}
                </option>
              </select>
              <div class="form-text">Icono FontAwesome</div>
              
              <!--Preview-->
              <div class="mt-3 text-center">
                <div class="symbol symbol-60px mx-auto">
                  <div class="symbol-circle" [ngClass]="'bg-light-' + moduleForm.get('color')?.value">
                    <i [class]="'fas ' + moduleForm.get('icon')?.value + ' fs-2x text-' + moduleForm.get('color')?.value"></i>
                  </div>
                </div>
                <small class="text-muted d-block mt-2">Vista previa</small>
              </div>
            </div>
            <!--end::Icon-->

            <!--begin::Color-->
            <div class="mb-6">
              <label class="form-label required fw-bold fs-6">Color</label>
              <div class="row g-2">
                <div *ngFor="let color of colorOptions" class="col-4">
                  <label class="form-check-label w-100">
                    <input 
                      type="radio" 
                      class="form-check-input d-none"
                      [value]="color.value"
                      formControlName="color">
                    <div 
                      class="p-3 rounded text-center cursor-pointer border"
                      [ngClass]="{
                        'border-primary border-3': moduleForm.get('color')?.value === color.value,
                        'border-gray-300': moduleForm.get('color')?.value !== color.value
                      }">
                      <div class="w-100 h-30px rounded mb-1" [ngClass]="color.class"></div>
                      <small class="text-muted">{{ color.label }}</small>
                    </div>
                  </label>
                </div>
              </div>
            </div>
            <!--end::Color-->
          </div>
        </div>

        <!--begin::Actions-->
        <div class="card">
          <div class="card-body">
            <button 
              type="submit" 
              class="btn btn-primary w-100 mb-3"
              [disabled]="isSaving || moduleForm.invalid">
              <i class="fas fa-save me-2" *ngIf="!isSaving"></i>
              <span class="spinner-border spinner-border-sm me-2" *ngIf="isSaving"></span>
              {{ isSaving ? 'Guardando...' : (isEditMode ? 'Actualizar M√≥dulo' : 'Crear M√≥dulo') }}
            </button>
            <button 
              type="button" 
              class="btn btn-light w-100"
              (click)="cancel()"
              [disabled]="isSaving">
              <i class="fas fa-times me-2"></i>
              Cancelar
            </button>
          </div>
        </div>
        <!--end::Actions-->
      </div>
      <!--end::Personalizaci√≥n-->
    </div>
  </form>
  <!--end::Form-->
</div>
<!--end::Formulario de M√≥dulo-->
