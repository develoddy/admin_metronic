<div class="card card-custom">
  <div class="card-header">
    <h3 class="card-title">
      <i class="fas fa-users mr-2"></i>
      Lista de Suscriptores
    </h3>
    <div class="card-toolbar">
      <button class="btn btn-sm btn-light-success mr-2" (click)="exportCSV()">
        <i class="fas fa-download mr-2"></i> Exportar CSV
      </button>
      <button class="btn btn-sm btn-light-primary" (click)="refresh()" [disabled]="loading">
        <i class="fas fa-sync-alt" [class.fa-spin]="loading"></i> Actualizar
      </button>
    </div>
  </div>

  <div class="card-body">
    <!-- Filters -->
    <div class="row mb-4">
      <div class="col-md-3">
        <input 
          type="text" 
          class="form-control" 
          placeholder="Buscar por email..."
          [(ngModel)]="searchTerm"
        />
      </div>
      <div class="col-md-2">
        <select class="form-control" [(ngModel)]="filterStatus">
          <option value="all">Todos los estados</option>
          <option value="pending">Pendiente</option>
          <option value="subscribed">Suscrito</option>
          <option value="unsubscribed">Desuscrito</option>
        </select>
      </div>
      <div class="col-md-2">
        <select class="form-control" [(ngModel)]="filterVerified">
          <option value="all">Verificación</option>
          <option value="true">Verificados</option>
          <option value="false">No verificados</option>
        </select>
      </div>
      <div class="col-md-2">
        <select class="form-control" [(ngModel)]="filterNotified">
          <option value="all">Notificación</option>
          <option value="true">Notificados</option>
          <option value="false">Pendientes</option>
        </select>
      </div>
      <div class="col-md-3 text-right">
        <span class="badge badge-primary badge-lg">
          {{ filteredSubscribers.length }} resultados
        </span>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="text-center py-5">
      <div class="spinner-border text-primary"></div>
      <p class="mt-3">Cargando suscriptores...</p>
    </div>

    <!-- Table -->
    <div *ngIf="!loading" class="table-responsive">
      <table class="table table-head-custom table-vertical-center table-hover">
        <thead>
          <tr>
            <th>Email</th>
            <th>Fuente</th>
            <th>Estado</th>
            <th>Verificado</th>
            <th>Notificado</th>
            <th>Fecha Registro</th>
            <th>UTM Source</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let subscriber of filteredSubscribers">
            <td>
              <span class="font-weight-bold">{{ subscriber.email }}</span>
            </td>
            <td>
              <span class="badge badge-light-info">{{ subscriber.source }}</span>
            </td>
            <td>
              <span class="badge" [ngClass]="{
                'badge-light-success': subscriber.status === 'subscribed',
                'badge-light-warning': subscriber.status === 'pending',
                'badge-light-danger': subscriber.status === 'unsubscribed'
              }">
                {{ subscriber.status }}
              </span>
            </td>
            <td>
              <span *ngIf="subscriber.email_verified" class="badge badge-success">
                <i class="fas fa-check"></i> Sí
              </span>
              <span *ngIf="!subscriber.email_verified" class="badge badge-warning">
                <i class="fas fa-clock"></i> No
              </span>
            </td>
            <td>
              <span *ngIf="subscriber.notified_launch" class="badge badge-info">
                <i class="fas fa-envelope-open"></i> Sí
              </span>
              <span *ngIf="!subscriber.notified_launch" class="badge badge-secondary">
                <i class="fas fa-envelope"></i> No
              </span>
            </td>
            <td>{{ subscriber.createdAt | date:'short' }}</td>
            <td>
              <span *ngIf="subscriber.utm_source" class="text-muted">
                {{ subscriber.utm_source }}
              </span>
              <span *ngIf="!subscriber.utm_source" class="text-muted">-</span>
            </td>
          </tr>
        </tbody>
      </table>

      <div *ngIf="filteredSubscribers.length === 0" class="text-center py-5 text-muted">
        <i class="fas fa-inbox fa-3x mb-3"></i>
        <p>No se encontraron suscriptores con los filtros aplicados</p>
      </div>
    </div>
  </div>
</div>
