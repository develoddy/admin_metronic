<div class="container-fluid">
  <!-- Breadcrumb -->
  <div class="row">
    <div class="col-lg-12">
      <div class="page-title-box d-flex align-items-center justify-content-between">
        <h4 class="mb-0">Gestión de Sitemap</h4>
        <div class="page-title-right">
          <ol class="breadcrumb m-0">
            <li class="breadcrumb-item"><a href="javascript: void(0);">Panel</a></li>
            <li class="breadcrumb-item"><a routerLink="/seo/config">SEO</a></li>
            <li class="breadcrumb-item active">Sitemap</li>
          </ol>
        </div>
      </div>
    </div>
  </div>

  <!-- Filters and Actions -->
  <div class="row">
    <div class="col-lg-12">
      <div class="card">
        <div class="card-body">
          <div class="row align-items-center">
            <div class="col-md-3">
              <select class="form-select" [(ngModel)]="filterType" (change)="applyFilters()">
                <option value="">Todos los tipos</option>
                <option *ngFor="let type of typeOptions" [value]="type.value">{{ type.label }}</option>
              </select>
            </div>

            <div class="col-md-3">
              <select class="form-select" [(ngModel)]="filterEnabled" (change)="applyFilters()">
                <option value="">Todos los estados</option>
                <option value="true">Habilitadas</option>
                <option value="false">Deshabilitadas</option>
              </select>
            </div>

            <div class="col-md-6 text-end">
              <button class="btn btn-soft-secondary me-2" (click)="clearFilters()">
                <i class="ri-filter-off-line me-1"></i> Limpiar Filtros
              </button>
              <button class="btn btn-primary" (click)="openAddModal()">
                <i class="ri-add-line me-1"></i> Añadir URL
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- URLs Table -->
  <div class="row">
    <div class="col-lg-12">
      <div class="card">
        <div class="card-body">
          <div class="table-responsive" *ngIf="!loading">
            <table class="table table-centered table-nowrap mb-0">
              <thead class="table-light">
                <tr>
                  <th style="width: 20px;">
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="checkAll">
                    </div>
                  </th>
                  <th>URL</th>
                  <th>Tipo</th>
                  <th>Prioridad</th>
                  <th>Frecuencia</th>
                  <th>Última Modificación</th>
                  <th>Estado</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let url of urls">
                  <td>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox">
                    </div>
                  </td>
                  <td>
                    <a [href]="url.loc" target="_blank" class="text-body fw-medium">
                      {{ url.loc }}
                    </a>
                    <p class="text-muted mb-0 font-size-12" *ngIf="url.metadata">
                      <ng-container [ngSwitch]="url.type">
                        <span *ngSwitchCase="'product'">ID: {{ getMetadataValue(url.metadata, 'productId') }}</span>
                        <span *ngSwitchCase="'category'">ID: {{ getMetadataValue(url.metadata, 'categoryId') }}</span>
                        <span *ngSwitchCase="'static'">Página: {{ getMetadataValue(url.metadata, 'page') }}</span>
                        <span *ngSwitchDefault>{{ getMetadataValue(url.metadata, 'description') || 'URL personalizada' }}</span>
                      </ng-container>
                    </p>
                  </td>
                  <td>
                    <span class="badge bg-{{ getTypeBadge(url.type) }}">
                      {{ getTypeLabel(url.type) }}
                    </span>
                  </td>
                  <td>{{ url.priority }}</td>
                  <td>{{ url.changefreq }}</td>
                  <td>{{ url.lastmod | date:'short' }}</td>
                  <td>
                    <div class="form-check form-switch">
                      <input class="form-check-input" type="checkbox" 
                             [checked]="url.enabled"
                             (change)="toggleEnabled(url)">
                    </div>
                  </td>
                  <td>
                    <button class="btn btn-sm btn-primary me-1" 
                            (click)="openEditModal(url)"
                            title="Editar">
                      <i class="ri-pencil-line"></i>
                    </button>
                    <button class="btn btn-sm btn-danger" 
                            (click)="deleteUrl(url)"
                            title="Eliminar">
                      <i class="ri-delete-bin-line"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>

            <div *ngIf="urls.length === 0" class="text-center py-5">
              <i class="ri-file-list-line font-size-48 text-muted"></i>
              <p class="text-muted mt-3">No hay URLs en el sitemap</p>
              <button class="btn btn-primary" (click)="openAddModal()">
                <i class="ri-add-line me-1"></i> Añadir Primera URL
              </button>
            </div>
          </div>

          <!-- Loading Spinner -->
          <div *ngIf="loading" class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Cargando...</span>
            </div>
          </div>

          <!-- Pagination -->
          <div class="row mt-4" *ngIf="totalPages > 1">
            <div class="col-lg-12">
              <ul class="pagination pagination-rounded justify-content-center mb-0">
                <li class="page-item" [class.disabled]="currentPage === 1">
                  <a class="page-link" href="javascript:void(0);" (click)="changePage(currentPage - 1)">
                    <i class="ri-arrow-left-s-line"></i>
                  </a>
                </li>
                <li class="page-item" *ngFor="let page of [].constructor(totalPages); let i = index"
                    [class.active]="currentPage === i + 1">
                  <a class="page-link" href="javascript:void(0);" (click)="changePage(i + 1)">
                    {{ i + 1 }}
                  </a>
                </li>
                <li class="page-item" [class.disabled]="currentPage === totalPages">
                  <a class="page-link" href="javascript:void(0);" (click)="changePage(currentPage + 1)">
                    <i class="ri-arrow-right-s-line"></i>
                  </a>
                </li>
              </ul>
            </div>
          </div>

          <!-- Total Info -->
          <div class="row mt-3">
            <div class="col-lg-12 text-center">
              <p class="text-muted mb-0">
                Mostrando {{ urls.length }} de {{ totalUrls }} URLs totales
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal para añadir/editar URL -->
<div class="modal fade" [class.show]="showModal" [style.display]="showModal ? 'block' : 'none'" 
     tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{ editingUrl ? 'Editar URL' : 'Añadir Nueva URL' }}</h5>
        <button type="button" class="btn-close" (click)="closeModal()"></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="urlForm">
          <div class="mb-3">
            <label class="form-label">URL Completa *</label>
            <input type="url" class="form-control" formControlName="loc" 
                   placeholder="https://tienda.lujandev.com/tu-pagina">
            <small class="text-muted">Debe comenzar con http:// o https://</small>
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">Tipo *</label>
                <select class="form-select" formControlName="type">
                  <option *ngFor="let type of typeOptions" [value]="type.value">
                    {{ type.label }}
                  </option>
                </select>
              </div>
            </div>

            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">Frecuencia de Cambio *</label>
                <select class="form-select" formControlName="changefreq">
                  <option *ngFor="let option of changefreqOptions" [value]="option.value">
                    {{ option.label }}
                  </option>
                </select>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">Prioridad (0.0 - 1.0) *</label>
                <input type="number" class="form-control" formControlName="priority" 
                       min="0" max="1" step="0.1">
                <small class="text-muted">0.0 = Menos importante, 1.0 = Más importante</small>
              </div>
            </div>

            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">Estado</label>
                <div class="form-check form-switch mt-2">
                  <input class="form-check-input" type="checkbox" id="urlEnabled" 
                         formControlName="enabled">
                  <label class="form-check-label" for="urlEnabled">
                    URL habilitada en el sitemap
                  </label>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">Cancelar</button>
        <button type="button" class="btn btn-primary" (click)="saveUrl()">
          <i class="ri-save-line me-1"></i>
          {{ editingUrl ? 'Actualizar' : 'Añadir' }}
        </button>
      </div>
    </div>
  </div>
</div>
<div class="modal-backdrop fade" [class.show]="showModal" *ngIf="showModal"></div>
